---
  # Gather vars using common gather task
  - name: firewalld | Gather | Gather vars
    include_role:
      name: common
      tasks_from: gather

  - name: firewalld | Ensure Installed
    package:
      name: "{{ firewalld }}"
      state: present
    become: true
    tags:
      - firewalld
      - packages

  - name: firewalld | Ensure Enabled
    systemd:
      name: firewalld
      enabled: yes
      state: started
    become: true
    notify: reload firewalld

  - name: firewalld | Internal Zone Sources
    firewalld:
      source: "{{ item }}"
      zone: internal
      state: enabled
    with_items: "{{ internal_networks }}"
    become: true
    notify: reload firewalld

  - name: firewalld | Fix "Cockpit" in FedoraServer zone
    lineinfile:
      path: /usr/lib/firewalld/zones/FedoraServer.xml
      regexp: '\s\s<service name="cockpit"/>'
      state: absent
    become: true
    notify: reload firewalld
